**金额篡改测试**设计的渗透测试用例，覆盖前端、传输过程、后端接口等关键攻击面，格式严格遵循您的要求：

---

### **测试用例1：前端隐藏参数篡改金额**
**测试步骤**  
[1] 选择商品/服务，进入支付页面  
[2] 浏览器开发者工具定位金额参数（如 `totalAmount`、`price`）  
[3] 修改参数值为异常值（如 `0.01` 或 `999999`）  
[4] 提交支付请求  

**期望结果**  
[1] 系统拦截篡改请求并返回错误  
[2] 后端校验日志记录非法操作  
[3] 用户界面显示“请求参数异常”  
[4] **实际支付金额与订单金额不一致时交易失败**  

---

### **测试用例2：HTTP请求重放与金额篡改**
**测试步骤**  
[1] 抓取正常支付请求（Burp Suite/Charles）  
[2] 修改请求体中的金额字段（如 `amount=100` → `amount=1`）  
[3] 重放篡改后的请求至服务器  
[4] 尝试多次重放不同金额值  

**期望结果**  
[1] 服务器拒绝签名无效的请求  
[2] 交易流水记录金额与原始订单不一致时终止  
[3] 风控系统触发异常交易报警  
[4] 重放请求被幂等性校验拦截  

---

### **测试用例3：负数金额攻击**
**测试步骤**  
[1] 构造支付请求，将金额改为负数（如 `amount=-100`）  
[2] 检查是否生成“退款”场景  
[3] 尝试组合使用：负数金额 + 高数量商品  
[4] 提交请求观察账户余额变化  

**期望结果**  
[1] 后端拒绝负数金额参数  
[2] 输入验证返回“金额需大于0”  
[3] 账户余额未发生异常增加  
[4] 数据库审计日志记录非法参数  

---

### **测试用例4：小数精度溢出攻击**
**测试步骤**  
[1] 输入超大小数位金额（如 `amount=10.999999999999999`）  
[2] 观察系统是否截断或四舍五入  
[3] 尝试金额累加（如0.1元重复支付1000次）  
[4] 验证最终账户扣款总额准确性  

**期望结果**  
[1] 系统强制保留2位小数  
[2] 财务计算使用Decimal/BigDecimal类型  
[3] 多次微额支付后总扣款 = 数量×单价  
[4] 资金对账无分厘误差  

---

### **测试用例5：优惠券与金额组合逻辑绕过**
**测试步骤**  
[1] 选择满减优惠券（如满100减20）  
[2] 篡改原始金额为99元后应用优惠券  
[3] 检查是否仍享受折扣  
[4] 尝试叠加使用多张限制优惠券  

**期望结果**  
[1] 优惠券使用前校验原始订单金额  
[2] 篡改后优惠券自动失效  
[3] 优惠规则在服务端强制执行  
[4] 异常优惠组合触发风控规则  

---

### **测试用例6：加密金额参数破解**
**测试步骤**  
[1] 分析前端加密逻辑（如AES/RSA）  
[2] 获取加密密钥或硬编码盐值  
[3] 构造加密后的非法金额密文  
[4] 替换请求中的加密参数并提交  

**期望结果**  
[1] 使用动态密钥（每次请求更换）  
[2] 密文被篡改后解密失败  
[3] 签名验证机制阻断无效请求  
[4] 密钥未暴露在前端代码中  

---

### **补充高级场景**
```markdown
| 测试场景          | 攻击手法                     | 防御期望                     |
|-------------------|----------------------------|----------------------------|
| 汇率篡改         | 修改外币兑换比例参数        | 汇率使用实时API不可覆盖     |
| 退款金额超限     | 退款金额＞原支付金额        | 退款值≤原支付金额的校验     |
| 订单金额篡改     | 修改历史订单金额重支付      | 订单金额归档不可变更        |
| 批量支付漏洞     | 单请求中重复同一订单ID      | 请求幂等性+订单状态机校验   |
```

> **关键防御原则**  
> 1. **三端校验**：前端展示值、传输加密值、服务端存储值独立校验  
> 2. **签名机制**：金额参数需带HMAC签名，防止中间人篡改  
> 3. **业务闭环**：支付金额必须与订单系统、库存系统强一致  
> 4. **审计追踪**：所有金额修改操作留痕+异地日志备份  

建议使用自动化工具辅助测试：  
```bash
# 使用Burp Suite的Intruder模块爆破金额参数
payloads = [0, -1, 999999, 0.009, 100-0.01]
# 使用SQLMap测试金额参数注入
sqlmap -u "https://pay.com?amount=100" -p amount --risk 3
```