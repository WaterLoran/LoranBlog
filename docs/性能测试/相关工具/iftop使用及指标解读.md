`iftop` 是一个实时流量监控工具，用于在命令行下监控网络带宽使用情况。它可以显示系统上各个网络连接的带宽使用情况、各连接的实时流量、总流量等。以下是 `iftop` 的基本用法和常见指标的解读：

### 一、安装 `iftop`

`iftop` 需要通过包管理工具安装。

- **CentOS / RHEL**:
  ```bash
  yum install iftop
  ```

- **Ubuntu / Debian**:
  ```bash
  apt install iftop
  ```

### 二、启动 `iftop`

可以直接在终端输入 `iftop` 来启动监控工具。常见启动命令有：

- **基本启动**：
  ```bash
  sudo iftop
  ```

- **指定网络接口**：
  ```bash
  sudo iftop -i eth0
  ```
  其中 `eth0` 是网络接口的名称，可以用 `ip a` 查看系统中的接口名称。

- **忽略本地流量**：
  ```bash
  sudo iftop -nNp -F <network_subnet>
  ```
  - `-n`：直接显示 IP 地址而不是解析域名。
  - `-N`：显示端口号而不是端口服务名称。
  - `-p`：启用 promiscuous mode，可以检测到更多流量。
  - `-F <network_subnet>`：忽略指定网段以外的流量。

### 三、`iftop` 界面指标解读

`iftop` 界面主要显示每个网络连接的流量情况，左侧是源IP，右侧是目标IP，中间箭头指向流量的传输方向。主要指标解读如下：

1. **TX / RX / TOTAL**
   - **TX**：表示出站流量（发送流量），即从本地到远程的流量。
   - **RX**：表示入站流量（接收流量），即从远程到本地的流量。
   - **TOTAL**：该连接的总流量，包括入站和出站流量之和。

2. **实时流量显示**（左、右和顶部的数值）
   - **实时流量**：每个连接会有三个时间窗口的数据，通常为 `2秒/10秒/40秒`。这些窗口显示的平均流量值，例如在 2 秒窗口的流量是最近 2 秒的平均值。
   - **顶部的总流量**：在屏幕顶部有三个总流量指标，分别是入站流量和出站流量的总和，时间窗口与单个连接的窗口相同（2 秒、10 秒、40 秒）。

3. **Peak（峰值）**
   - 每个连接的峰值流量，反映该连接在监控期间的最大速率。
   - 有助于判断网络连接的带宽高峰。

4. **Cumulative (累积流量)**
   - 从`iftop`启动到当前的累积流量数据。
   - 可以用来分析应用的带宽占用总量。

5. **Ports（端口）**
   - 每个连接对应的端口号，可以帮助识别不同应用的数据流。
   - 如果没有指定 `-N` 参数，`iftop` 默认会尝试将端口号解析为服务名称，例如 `http`、`https`。

### 四、`iftop` 常用按键

在运行`iftop`时，可以使用以下按键来切换不同的显示模式：

- **p**：切换是否显示端口信息。
- **P**：切换显示本地端口和远程端口。
- **n**：切换是否解析主机名（仅显示IP地址）。
- **b**：切换显示的流量计量单位（bits/bytes）。
- **t**：切换显示界面上下部分，显示数据传输方向。
- **L**：限制显示的最大连接数（提高性能）。
- **q**：退出 `iftop`。

### 五、使用场景

1. **监控带宽使用情况**：实时了解当前的网络流量，识别哪些IP和端口正在消耗带宽。
2. **故障排查**：在网络异常缓慢时，快速定位流量高峰的来源。
3. **带宽占用分析**：帮助优化应用，避免高带宽应用影响其他业务。

通过以上指标和按键，`iftop` 可以成为网络流量监控的好工具，帮助用户更好地了解网络带宽的使用情况并进行合理的管理和优化。