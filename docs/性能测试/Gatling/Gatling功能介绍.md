Gatling功能介绍

### Gatling 的核心功能

#### 1. 协议支持 (Protocol Support)
Gatling 的核心是模拟用户与系统的交互，因此它支持多种网络协议：
*   **HTTP/HTTPS**：这是最核心、最强大的功能。支持所有现代 HTTP 特性，如缓存、Cookie、持久连接、SSL/TLS、重定向、ETag 等。
*   **HTTP/2**：支持最新的 HTTP/2 协议，用于测试高性能的现代Web服务。
*   **WebSocket**：用于测试需要长连接、实时双向通信的应用（如聊天应用、实时游戏、推送服务）。
*   **JMS** (Java Message Service)：通过插件，可以测试基于消息中间件（如 ActiveMQ, IBM MQ）的应用性能。
*   **JDBC**：可以直接对数据库执行 SQL 语句，进行数据库层面的性能测试。
*   **gRPC**：通过社区插件，可以对 gRPC 服务进行性能测试。
*   **SSH**、**FTP** 等也有相关支持。

#### 2. 强大的场景设计 (Scenario Design)
这是 Gatling 的灵魂，允许你定义非常复杂和真实的用户行为。
*   **定义用户流程**：将多个请求组织成一个完整的用户操作序列（例如：登录 -> 浏览商品 -> 添加购物车 -> 付款）。
*   **控制流程逻辑**：
    *   **条件语句**：使用 `doIf` 根据之前的响应结果决定下一步做什么。
    *   **循环**：使用 `repeat` 循环执行某些操作。
    *   **退出**：使用 `exitBlockOnFail` 确保在关键步骤失败时整个虚拟用户会停止。
*   ** pauses**：插入精确的停顿，模拟用户思考时间。支持固定时间和随机时间（如 `uniformPause(2, 5)` 表示在2到5秒之间随机停顿）。

#### 3. 负载模型 (Load Modeling)
Gatling 允许你精确控制虚拟用户如何被注入系统，以模拟真实的负载模式。
*   **多种注入策略**：
    *   **`constantUsersPerSec`**：每秒注入固定数量的用户。
    *   **`rampUsers`**：在指定时间内线性增加到某个数量的用户。
    *   **`atOnceUsers`**：一次性同时注入多个用户。
    *   **`stressPeak`**：进行压力峰值测试。
    *   **`incrementUsersPerSec`**：逐步增加每秒用户数，直到达到极限。
*   **并发与设置**：可以定义最大并发用户数，并设置测试的总时长。

#### 4. 数据驱动测试 (Data-Driven Testing)
为了模拟真实用户，测试数据需要多样化。
*   **Feeder**：这是 Gatling 的数据源机制，可以从外部文件读取数据，并注入到请求中。
    *   支持多种格式：**CSV**、**JSON**、**TSV**。
    *   支持多种读取策略：**队列**（顺序读取）、**随机**、**循环**、**共享**。
*   **会话管理**：每个虚拟用户都有一个独立的 `Session` 对象，用于存储和传递数据。你可以在一个步骤中从响应中提取数据（如 token、用户ID），存入 Session，然后在后续的请求中使用。

#### 5. 结果验证与断言 (Validation & Assertion)
性能测试不仅是发送请求，还要验证响应是否正确和满足性能要求。
*   **Checks**：
    *   **状态码检查**：例如 `check(status.is(200))`。
    *   **响应体检查**：使用 JSONPath、CSS 选择器、正则表达式等从响应中提取和验证内容。
    *   **响应头检查**：验证特定的头部信息。
*   **断言**：在仿真（Simulation）层级设置全局断言，以判断整个测试是否通过。例如：“全局95%的请求响应时间必须小于100ms”、“失败率必须低于1%”。如果断言失败，Gatling 会以非零状态码退出，这对于 CI/CD 集成至关重要。

#### 6. 丰富的报告与分析 (Reporting & Analysis)
Gatling 的报告是其一大亮点。
*   **自动生成**：测试结束后会自动生成一份详尽的 HTML 报告。
*   **交互式图表**：报告包含大量可视化图表，如：
    *   **活跃用户数随时间变化图**。
    *   **响应时间分布图**（展示OK和KO的请求）。
    *   **响应时间百分位数图**（如50th, 75th, 95th, 99th）。
    *   **请求数/吞吐量图**。
*   **详细信息**：可以向下钻取查看每个请求的详细统计数据。

#### 7. 录制器 (Recorder)
为了降低脚本编写门槛，Gatling 提供了图形化录制器。
*   **HTTP Proxy Recorder**：将浏览器代理设置为 Gatling Recorder，所有经过代理的 HTTP/HTTPS 流量都会被捕获并生成对应的 Scala 脚本骨架。
*   **HAR Converter**：可以直接导入浏览器导出的 `.har` (HTTP Archive) 文件，将其转换为 Gatling 脚本。

#### 8. 持续集成/持续部署 (CI/CD) 集成
Gatling 天生为自动化而生。
*   **命令行操作**：所有操作都可以通过命令行完成，无需GUI。
*   **易于集成**：可以轻松地与 **Jenkins**、**GitLab CI**、**TeamCity** 等主流 CI/CD 工具集成。
*   **构建工具插件**：提供 **Maven** 和 **Gradle** 插件，可以将性能测试作为项目构建的一部分来运行。

### 总结表格

| 功能类别     | 具体功能                                   | 说明                                   |
| :----------- | :----------------------------------------- | :------------------------------------- |
| **协议支持** | HTTP/S, HTTP/2, WebSocket, JMS, JDBC, gRPC | 覆盖主流应用通信协议                   |
| **场景设计** | 用户流程、条件判断、循环、暂停             | 模拟真实、复杂的用户行为逻辑           |
| **负载模型** | 多种注入策略（恒定、线性增长、一次性等）   | 精确控制并发用户数和测试节奏           |
| **数据驱动** | Feeder (CSV, JSON)、会话管理               | 参数化请求，模拟不同用户使用不同数据   |
| **结果验证** | 状态码/响应体检查、全局断言                | 验证功能正确性和性能指标是否达标       |
| **报告分析** | 交互式HTML报告、丰富图表、百分位数         | 直观定位性能瓶颈，生成专业测试报告     |
| **易用性**   | 录制器、HAR转换                            | 降低脚本编写难度，快速生成基础脚本     |
| **自动化**   | 命令行运行、CI/CD集成、Maven/Gradle插件    | 完美融入DevOps流程，实现自动化性能测试 |

总而言之，Gatling 不仅仅是一个“发压工具”，而是一个**功能齐全、表达能力强、适用于自动化且面向开发者的现代化性能测试框架**。它的核心优势在于用代码定义复杂测试场景的能力、极低的资源开销以及出色的报告系统。