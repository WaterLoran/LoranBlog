# 性能瓶颈定位思路

本文摘抄自<企业性能测试: 体系构建, 落地指导与案例解读>

## 接口响应慢

### 是否与数据库交互导致耗时长

1. 慢SQL长时间占用连接
2. 业务逻辑中有频繁访问数据库的情况
3. 连接池设置过小
4. 数据库服务器硬件配置过低也是访问数据库耗时长的原因

### 是否与Redis交互导致耗时长

1. 慢查询
2. 访问Redis频率过高
3. 受连接池大小限制
4. Redis硬件配置低

### 是不是消息队列谁送消息慢

### 是不是其他业务方法慢

1. 是否有所竞争导致的县城阻塞等待
2. 是否使用了CountDounLatch, CyclicBarrier, Thread.join. Object.wait等跨线程同步的方法
3. 是否使用了正则表达式
4. 是否有线程池耗尽现象

## 资源消耗不高, TPS无法提升

### 内部瓶颈

线程阻塞严重, , 线程池耗尽

## TPS逐渐降低

1. 内存泄露
2. 表数据量变大
3. 磁盘满

## 响应时间/TPS尖刺

1. 缓存击穿
2. GC停顿时间长
   GC回收效果差, GC线程数过小, 对内存过大, 网卡积压, 服务器上其他进程导致资源争用, 宿主机资源争用或资源超分

## 错误类型多, 错误率高

1. 限流导致报错
2. 代码跑一场
3. 网络或连接异常
4. 服务器可用端口不足

## 资源指标异常

### CPU

1. 死循环导致CPU耗尽
2. 爬栈导致CPU消耗高
3. 频繁抛一擦会给你导致CPU消耗高
4. 正则匹配和正则替换
5. 加密和解密操作
6. 其他导致CPU消耗的操作

### 内存

1. 内存增长快
2. 内存泄露

### 磁盘IO

1. 写业务日志
2. 读写其他业务文件

### 网络IO

1. 云服务有贷款限制
2. 异地多机房走专项, 可能会有网络带宽瓶颈
3. 网卡积压问题

## 快速定位复杂系统容量瓶颈

1. 查看容量测试那些接口的响应时间的增长斜率较大, 在不断增加压力时, 如果某个接口的关联资源已经成为瓶颈, 那么他的响应时间的增长斜率(或者错误斜率)会明显大于其他接口
2. 如果有多个慢接口, 那就需要梳理慢接口的链路拓扑图并取其交集, 交集内的节点成为瓶颈的概率一定是高于交集外的, 这些节点需要重点关注. 接下来和第一点的思路类似, 已知某个接口是瓶颈后, 就要进行单接口瓶颈定位了.
3. 在复杂系统下, 除了服务自身的性能问题以及中间件, 数据库的性能外, 还需要注意是都存在负载不均的问题, 对此需要选择合理的负载均衡策略.











