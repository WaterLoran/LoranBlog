Wireshark 是一款强大的图形化抓包工具，用于网络协议分析、故障排查和流量监控。以下是使用 Wireshark 进行抓包的步骤及其常见用法：

### 一、Wireshark 的基本使用步骤

1. **启动 Wireshark 并选择网卡**：
   - 打开 Wireshark，选择要捕获流量的网络接口（如 `eth0`、`en0` 或 `Wi-Fi`），点击 `Start` 开始捕获。
2. **设置捕获过滤器**：
   - 在启动捕获前，可以设置捕获过滤器来减少无关流量（如只捕获 HTTP 流量）：`tcp port 80`。
3. **实时监控和分析数据包**：
   - 捕获过程中，可以查看每个数据包的详细信息（源 IP、目的 IP、协议、内容等）。
4. **使用显示过滤器**：
   - 捕获后使用显示过滤器（如 `http`、`tcp`、`udp`、`ip.addr==192.168.1.1`）来精确查找目标数据包。
5. **保存和读取数据包**：
   - 将捕获的数据包保存为 `.pcap` 文件，或从已有 `.pcap` 文件中读取数据进行分析。

### 二、常用的抓包场景

1. **捕获 HTTP 流量**：
   - 捕获端口 80 的流量：`tcp port 80`
   - 查看 HTTP 请求和响应内容。
2. **捕获 HTTPS 流量并解密**：
   - 配置 Wireshark 以解密 HTTPS 流量，导入私钥（`Preferences -> Protocols -> SSL -> RSA keys`）。
3. **过滤特定 IP 地址**：
   - 只查看来自或发往 `192.168.1.1` 的数据包：`ip.addr == 192.168.1.1`
4. **查看 DNS 流量**：
   - 过滤 DNS 请求和响应：`udp port 53`

### 三、常见问题及排查

1. **无权限问题**：
   - 在 Linux 或 macOS 中，以 root 身份运行 Wireshark。
2. **未选择正确网卡**：
   - 使用 `Capture Options` 检查接口流量，选择有数据传输的接口。
3. **流量太大无法分析**：
   - 使用捕获过滤器或显示过滤器减少无关流量。

### 四、Wireshark 的抓包样例

1. **只捕获 TCP 流量**：

   ```
   plaintext复制代码tcp
   ```

2. **捕获源 IP 为 192.168.1.1 的 HTTP 流量**：

   ```
   plaintext复制代码tcp port 80 and src host 192.168.1.1
   ```

通过这些步骤和过滤器，Wireshark 能够有效分析网络流量并定位网络问题。