# 数据库兼容性测试

## 术语说明

通常软件系统是以Mysql数据库为基础开发的, 但有些客户有些特殊的要求, 比如需要使用oracle, 或者sqlserver, 或者达梦数据库, 那么我们就需要修改我们代码逻辑中数据库相关的连接, 增删查改来满足要求. 所以数据库兼容性测试, 就是为了能够让系统能够在不同的数据库上正常运行, 质量诉求维度主要是功能, 性能则不太涉及或者要求

## 历史包袱

在软件开发的初期, 为了快速研发, 就直接编写sql语句, 这将会大致, sql语句不能够兼容不同的数据库类型, 而在后期想要统一的时候, 则会遇到一定程度的重构成本, 这就是历史包袱

## 为什么要做兼容性测试

一个是代码逻辑, 另外一个就是数据. 通常情况下, 我们的系统中代码逻辑是通过镜像发布的, 在追溯方面能力很强, 并且能够做到统一发布, 即不太可能会因为镜像拷贝而出现逻辑错乱或者和研发场景不一致的情况. 而数据则是让人头疼的地方, 在升级的时候, 涉及到数据表结构的变换, 以及相关数据的变更, 如果代码的处理逻辑不严谨或者没经过充分的测试, 那么就会因为一个疏忽而导致数据表结构的异常即不满足预期. 以及在数据的转换过程中, 也有可能会因为数据值的差异, 让代码处理逻辑出现异常的情况. 所以, 我们需要做兼容性测试

## 传统测试

即理论上是要通过执行所有的功能来保证, 比如执行所有的自动化脚本, 或者直接手工将所有的功能都执行一遍. 明显的这是很费劲的事情, 并且容易出错, 并且覆盖率不够高.

## 最终选择的测试方法

使用工具对比出待兼容数据库 和 对照组(即正常研发场景下常用的数据库)的差异, 差异主要包括, 有无相关数据表, 相同的数据表中有无同样的字段, 对于字段的属性是否都相同(主要是指数据类型, 是否可为NULL ,默认值). 理论上只要数据表无差异, 那么就不会因为数据表结构的原因而引入BUG.

接着再执行所有的自动化脚本, 因为这个时候, 还是有可能是因为sql语句针对于不同的系统之间的差异, 而导致增删查改失败. 

最后一个维度是数据值的差异, 但是这个过程工作量极大, 并且系统不太可能因为数据值的不同而出现问题, 至少概率不大, 如果有的话, 就出现在配置相关的数据表, 比如JECN_CONFIG_ITEM. 但是这个环节在实际的测试中并乜有去做