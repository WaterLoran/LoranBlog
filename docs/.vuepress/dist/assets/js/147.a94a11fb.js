(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{581:function(e,a,t){"use strict";t.r(a);var r=t(2),o=Object(r.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"litemall性能测试实战-05搭建监控系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#litemall性能测试实战-05搭建监控系统"}},[e._v("#")]),e._v(" Litemall性能测试实战_05搭建监控系统")]),e._v(" "),a("h2",{attrs:{id:"部署prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署prometheus"}},[e._v("#")]),e._v(" 部署prometheus")]),e._v(" "),a("ol",[a("li",[e._v("下载并上传二进制的prometheus安装包到Linux后台\n[root@localhost software]# ll\n-rw-rw-r--. 1 water water 75820407 2月  27 17:42 prometheus-2.33.4.linux-amd64.tar.gz\n[root@localhost software]#")]),e._v(" "),a("li",[e._v("解压文件到指定目录\n[root@localhost software]# tar xf prometheus-2.33.4.linux-amd64.tar.gz -C /usr/local/")]),e._v(" "),a("li",[e._v("设置环境变量\n[root@localhost prometheus-2.33.4.linux-amd64]# vim /etc/profile\n[root@localhost prometheus-2.33.4.linux-amd64]#\nexport PROMETHEUS_HOME=/usr/local/prometheus-2.25.0.linux-amd64\nPATH=$PROMETHEUS_HOME:/bin\nexport PATH")]),e._v(" "),a("li",[e._v('使用nohup的方式拉起prometheus服务\n[root@localhost prometheus-2.33.4.linux-amd64]# nohup ./prometheus --config.file="prometheus.yml" &\n[1] 12093\n[root@localhost prometheus-2.33.4.linux-amd64]# nohup: 忽略输入并把输出追加到"nohup.out"')]),e._v(" "),a("li",[e._v("关闭centos防火墙\n阿里云的虚拟机默认不打开防火墙,但需要在安全组中放开端口\n其他虚拟机需要检查一下防火墙\n可以使用netstat -tlunp来检查在监听哪一些端口")])]),e._v(" "),a("h2",{attrs:{id:"部署node-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署node-exporter"}},[e._v("#")]),e._v(" 部署node_exporter")]),e._v(" "),a("ol",[a("li",[e._v("下载node_exporter二进制安装包并上传到Linux后台")]),e._v(" "),a("li",[e._v("解压到指定目录\n[root@localhost software]# tar xf node_exporter-1.3.1.linux-amd64.tar.gz -C /usr/local/\n[root@localhost software]# ll /usr/local/ | grep node\ndrwxr-xr-x. 2 3434 3434  56 12月  5 19:15 node_exporter-1.3.1.linux-amd64\n[root@localhost software]#")]),e._v(" "),a("li",[e._v('使用nohup拉起该服务\n[root@localhost node_exporter-1.3.1.linux-amd64]# nohup ./node_exporter &\n[2] 12417\n[root@localhost node_exporter-1.3.1.linux-amd64]# nohup: 忽略输入并把输出追加到"nohup.out"')]),e._v(" "),a("li",[e._v("修改prometheus的启动配置文件并重启\n"),a("ul",[a("li",[e._v('job_name:"Centos7"\nstatic_configs:- targets: ["localhost:9100"]')])])]),e._v(" "),a("li",[e._v('重启prometheus,用于接收node_exporter的数据\nnohup ./prometheus --config.file="prometheus.yml" &')])]),e._v(" "),a("h2",{attrs:{id:"部署grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署grafana"}},[e._v("#")]),e._v(" 部署grafana")]),e._v(" "),a("ol",[a("li",[e._v("下载并上传文件到Linux\n下载地址: https://grafana.com/grafana/download?platform=linux\n二进制下载地址   https://dl.grafana.com/enterprise/release/grafana-enterprise-8.4.2.linux-amd64.tar.gz")]),e._v(" "),a("li",[e._v("解压到指定目录\n[root@localhost software]# tar xf grafana-enterprise-8.4.2.linux-amd64.tar.gz -C /usr/local")]),e._v(" "),a("li",[e._v("设置环境变量\nvim /etc/profile\nexport GRAFANA_HOME=/usr/local/grafana-8.4.2\nPATH=$PATH:$GRAFANA_HOME/bin\nexport PATH")]),e._v(" "),a("li",[e._v("使用nohup拉起服务\nnohup grafana-server &")]),e._v(" "),a("li",[e._v("修改grafana原始密码\n原始密码为admin/admin")]),e._v(" "),a("li",[e._v("在grafana上对接prometheus\n添加数据源")]),e._v(" "),a("li",[e._v("导入dashboard的模板\nnode_exporter专用的dashboard为1860,比较全面")])]),e._v(" "),a("h2",{attrs:{id:"部署mysqld-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署mysqld-exporter"}},[e._v("#")]),e._v(" 部署mysqld_exporter")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("下载安装包\nwget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz")])]),e._v(" "),a("li",[a("p",[e._v("解压安装包到  /usr/local")]),e._v(" "),a("p",[e._v("tar xf mysqld_exporter-0.14.0.linux-amd64.tar.gz -C /usr/local/")])]),e._v(" "),a("li",[a("p",[e._v("如果直接在mysqld_exporter目录执行拉起服务的话,不用配置环境变量\n不用配置环境变量")])]),e._v(" "),a("li",[a("p",[e._v("进入mysql创建用户  mysql_monitor ,用于读取mysql数据,不直接使用root用户是为了安全考虑,面向生产")]),e._v(" "),a("p",[e._v("CREATE USER 'mysql_monitor'@'localhost' IDENTIFIED BY 'Litemall@123';")]),e._v(" "),a("p",[e._v("flush privileges;")])]),e._v(" "),a("li",[a("p",[e._v("修改配置文件")]),e._v(" "),a("p",[e._v("vim /opt/mysqld_exporter/.my.cnf")]),e._v(" "),a("p",[e._v("输入")]),e._v(" "),a("p",[e._v("[client]")]),e._v(" "),a("p",[e._v("user=mysql_monitor")]),e._v(" "),a("p",[e._v("password=Litemall@123")])]),e._v(" "),a("li",[a("p",[e._v("使用nohup拉起进程,并且指定配置文件\nnohup ./mysqld_exporter --config.my-cnf=./.my.cnf &")])]),e._v(" "),a("li",[a("p",[e._v("查看是否开启监听9104默认端口")]),e._v(" "),a("p",[e._v("netstat -tlunp")])]),e._v(" "),a("li",[a("p",[e._v("配置prometheus添加mysqld_exporter工程")]),e._v(" "),a("p",[e._v("追加")]),e._v(" "),a("p",[e._v('- job_name: "Mysql_exporter"')]),e._v(" "),a("p",[e._v("​    static_configs:")]),e._v(" "),a("p",[e._v('​      - targets: ["localhost:9104"]')])]),e._v(" "),a("li",[a("p",[e._v("重启prometheus")]),e._v(" "),a("p",[e._v("pkil prometheus")]),e._v(" "),a("p",[e._v('nohup ./prometheus --config.file="prometheus.yml" &')])]),e._v(" "),a("li",[a("p",[e._v("grafana端导入dashboard的时候,使用  7362  dashboard模板")])])]),e._v(" "),a("h2",{attrs:{id:"部署jmx-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署jmx-exporter"}},[e._v("#")]),e._v(" 部署jmx_exporter")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("创建工作目录\nmkdir -p /usr/local/jmx_exporter")])]),e._v(" "),a("li",[a("p",[e._v("下载jmx_exporter\nwget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.16.1/jmx_prometheus_javaagent-0.16.1.jar")])]),e._v(" "),a("li",[a("p",[e._v("配置文件jmx_exporter\nvim /usr/local/jmx_exporter/jmx_exporter.yml\n输入下面内容")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("---  \nlowercaseOutputLabelNames: true\nlowercaseOutputName: true\nwhitelistObjectNames: [\"java.lang:type=OperatingSystem\"]\nblacklistObjectNames: []\nrules:\n  - pattern: 'java.lang<type=OperatingSystem><>(committed_virtual_memory|free_physical_memory|free_swap_space|total_physical_memory|total_swap_space)_size:'\n    name: os_$1_bytes\n    type: GAUGE\n    attrNameSnakeCase: true\n  - pattern: 'java.lang<type=OperatingSystem><>((?!process_cpu_time)\\w+):'\n    name: os_$1\n    type: GAUGE\n    attrNameSnakeCase: true\n")])])])]),e._v(" "),a("li",[a("p",[e._v("使用java启动重新启动之前的litemall编译出来的jar包")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("xxxxxxxxxx nohup java -javaagent:/usr/local/jmx_exporter/jmx_prometheus_javaagent-0.16.1.jar=3010:/usr/local/jmx_exporter/jmx_exporter.yml -Dfile.encoding=UTF-8 -jar  /usr/local/litemall/litemall-all/target/litemall-all-0.1.0-exec.jar &\n")])])]),a("p",[e._v("注意: /root/.m2/repository/org/linlinjava/litemall-all/0.1.0/litemall-all-0.1.0-exec.jar 这个包是我们要监控的软件程序的对应的jar包, 那么在运行软件的时候,就可以同时被监控了,-javaagent表示启动参数")])]),e._v(" "),a("li",[a("p",[e._v("导入Dashboard模板8563, 注意job的输入需要和那个prometheus.yml文件中配置的一致,这个和其他的不太一样")])]),e._v(" "),a("li",[a("p",[e._v('重启prometheus\npkil prometheus\nnohup ./prometheus --config.file="prometheus.yml" &')])])]),e._v(" "),a("h2",{attrs:{id:"停止所有的监控服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止所有的监控服务"}},[e._v("#")]),e._v(" 停止所有的监控服务")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("pkill prometheus\npkill node_exporter\npkill grafana\npkill mysqld_exporter\n")])])]),a("h2",{attrs:{id:"启动所有的监控服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动所有的监控服务"}},[e._v("#")]),e._v(" 启动所有的监控服务")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('cd /usr/local/prometheus-2.33.4.linux-amd64\nnohup ./prometheus --config.file="./prometheus.yml" &\n \ncd  /usr/local/grafana-8.4.2\n nohup ./bin/grafana-server &\n \ncd /usr/local/mysqld_exporter-0.14.0.linux-amd64\nnohup ./mysqld_exporter --config.my-cnf=./.my.cnf &\n\ncd /usr/local/node_exporter-1.*.linux-amd64\nnohup ./node_exporter &\n')])])])])}),[],!1,null,null,null);a.default=o.exports}}]);