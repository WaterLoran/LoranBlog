(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{594:function(s,t,a){"use strict";a.r(t);var r=a(2),e=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("在持续压测过程中，数据库内存持续增大的可能原因及对应的排查方法、命令和单位如下：")]),s._v(" "),t("h3",{attrs:{id:"_1-缓存机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-缓存机制"}},[s._v("#")]),s._v(" 1. 缓存机制")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 数据库会将数据和索引加载到内存中以提高查询速度。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_buffer_pool_size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 字节")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_buffer_pool_bytes_data'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 字节")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_buffer_pool_bytes_dirty'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 字节")]),s._v("\n")])])])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": "),t("code",[s._v("Innodb_buffer_pool_bytes_data")]),s._v(" 应小于 "),t("code",[s._v("Innodb_buffer_pool_size")]),s._v(" 的70%-80%。")])]),s._v(" "),t("h3",{attrs:{id:"_2-未释放的内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-未释放的内存"}},[s._v("#")]),s._v(" 2. 未释放的内存")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 内存泄漏可能导致持续的内存增长。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": 检查“Memory”部分的使用情况，特别关注分配和释放的对象数量。")])])])]),s._v(" "),t("h3",{attrs:{id:"_3-连接数增加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-连接数增加"}},[s._v("#")]),s._v(" 3. 连接数增加")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 高并发可能导致打开的连接数不断增加。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Threads_connected'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 连接数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Threads_running'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 正在运行的连接数")]),s._v("\n")])])])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": 监控连接数，超过200个连接时需考虑优化。")])]),s._v(" "),t("h3",{attrs:{id:"_4-临时表和排序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-临时表和排序"}},[s._v("#")]),s._v(" 4. 临时表和排序")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 大量临时表的使用会占用内存。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Created_tmp_tables'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 计数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Created_tmp_disk_tables'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 计数")]),s._v("\n")])])])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": "),t("code",[s._v("Created_tmp_disk_tables")]),s._v(" 的数量应尽量小于 "),t("code",[s._v("Created_tmp_tables")]),s._v("，理想状态是二者比例大约为10%。")])]),s._v(" "),t("h3",{attrs:{id:"_5-长时间运行的查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-长时间运行的查询"}},[s._v("#")]),s._v(" 5. 长时间运行的查询")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 长时间未结束的查询占用内存。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" PROCESSLIST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看所有进程")]),s._v("\n")])])])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": 检查运行时间超过5秒的查询，并考虑优化。")])]),s._v(" "),t("h3",{attrs:{id:"_6-事务和锁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-事务和锁"}},[s._v("#")]),s._v(" 6. 事务和锁")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("原因")]),s._v(": 开启的事务和锁占用内存。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("排查方法")]),s._v(":")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": 查看锁和事务信息，确保没有长时间占用的事务。")])])])]),s._v(" "),t("h3",{attrs:{id:"_7-内存配置不当"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-内存配置不当"}},[s._v("#")]),s._v(" 7. 内存配置不当")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 不合理的内存设置可能导致高内存使用。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_buffer_pool_size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 字节")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'innodb_log_file_size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 字节")]),s._v("\n")])])])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": "),t("code",[s._v("innodb_buffer_pool_size")]),s._v(" 应为总内存的70-80%，例如总内存为16GB时，设置为12GB（"),t("code",[s._v("12 * 1024 * 1024 * 1024")]),s._v("）。")])]),s._v(" "),t("h3",{attrs:{id:"_8-大数据集的处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-大数据集的处理"}},[s._v("#")]),s._v(" 8. 大数据集的处理")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("原因")]),s._v(": 处理大批量数据时会消耗大量内存。")]),s._v(" "),t("li",[t("strong",[s._v("排查方法")]),s._v(":\n"),t("ul",[t("li",[t("strong",[s._v("命令")]),s._v(":"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_rows_inserted'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 计数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Innodb_rows_updated'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 计数")]),s._v("\n")])])])])])]),s._v(" "),t("li",[t("strong",[s._v("参考标准")]),s._v(": 监控插入和更新的行数，识别大批量操作，检查是否有异常增加。")])]),s._v(" "),t("h3",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("通过以上命令及其输出单位，可以有效识别和解决数据库在持续压测过程中内存持续增大的原因。定期监控并根据参考标准进行调整，有助于保持数据库性能的稳定性。")])])}),[],!1,null,null,null);t.default=e.exports}}]);