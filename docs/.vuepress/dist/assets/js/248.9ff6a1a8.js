(window.webpackJsonp=window.webpackJsonp||[]).push([[248],{679:function(t,s,a){"use strict";a.r(s);var v=a(2),_=Object(v.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("code",[t._v("tcpdump")]),t._v(" 是一款强大的命令行抓包工具，常用于 Linux/Unix 系统中进行网络流量捕获和分析。它能够实时监控网络接口的流量，并支持多种过滤规则来精确捕获目标数据包。以下是 "),s("code",[t._v("tcpdump")]),t._v(" 的常用抓包方法和相关样例。")]),t._v(" "),s("h3",{attrs:{id:"一、基本抓包命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、基本抓包命令"}},[t._v("#")]),t._v(" 一、基本抓包命令")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("捕获所有流量")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：默认在指定的 "),s("code",[t._v("eth0")]),t._v(" 接口上捕获所有流量。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("捕获并显示指定数量的包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 -c 10\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：捕获 "),s("code",[t._v("eth0")]),t._v(" 接口上的前 10 个数据包，然后退出。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("保存数据包到文件")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 -w capture.pcap\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：将 "),s("code",[t._v("eth0")]),t._v(" 接口上的流量保存到 "),s("code",[t._v("capture.pcap")]),t._v(" 文件中，供之后分析。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("从文件中读取并解析数据包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -r capture.pcap\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：读取并解析保存的 "),s("code",[t._v("capture.pcap")]),t._v(" 文件。")])])])]),t._v(" "),s("h3",{attrs:{id:"二、使用过滤表达式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、使用过滤表达式"}},[t._v("#")]),t._v(" 二、使用过滤表达式")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("过滤特定的 IP 地址")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 host 192.168.1.10\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：仅捕获源地址或目标地址为 "),s("code",[t._v("192.168.1.10")]),t._v(" 的数据包。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("过滤特定端口的数据包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 port 80\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：仅捕获 TCP/UDP 端口号为 "),s("code",[t._v("80")]),t._v(" 的数据包。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("过滤特定协议的数据包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 tcp\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：仅捕获 TCP 协议的数据包。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("排除特定 IP 地址的数据包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 not host 192.168.1.10\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：排除源或目的地址为 "),s("code",[t._v("192.168.1.10")]),t._v(" 的数据包。")])])])]),t._v(" "),s("h3",{attrs:{id:"三、高级抓包示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、高级抓包示例"}},[t._v("#")]),t._v(" 三、高级抓包示例")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("捕获 HTTP 请求并显示数据内容")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -A -s 0 -i eth0 port 80\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：使用 "),s("code",[t._v("-A")]),t._v(" 以 ASCII 格式显示数据包内容，"),s("code",[t._v("-s 0")]),t._v(" 读取完整数据包。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("捕获指定源 IP 和目的端口的数据包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 src 192.168.1.10 and dst port 443\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：仅捕获源 IP 为 "),s("code",[t._v("192.168.1.10")]),t._v(" 且目的端口为 "),s("code",[t._v("443")]),t._v(" 的数据包。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("实时查看 DNS 请求")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 udp port 53\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：捕获 "),s("code",[t._v("eth0")]),t._v(" 接口上的所有 DNS 请求（UDP 端口 53）。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("捕获特定主机之间的 ICMP 数据包")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bash复制代码sudo tcpdump -i eth0 icmp and host 192.168.1.20\n")])])]),s("ul",[s("li",[s("strong",[t._v("说明")]),t._v("：仅捕获与 "),s("code",[t._v("192.168.1.20")]),t._v(" 相关的 ICMP（Ping）数据包。")])])])]),t._v(" "),s("h3",{attrs:{id:"四、排查-tcpdump-的常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、排查-tcpdump-的常见问题"}},[t._v("#")]),t._v(" 四、排查 "),s("code",[t._v("tcpdump")]),t._v(" 的常见问题")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("未使用管理员权限")]),t._v("：\n"),s("ul",[s("li",[t._v("问题：如果未使用 "),s("code",[t._v("sudo")]),t._v(" 或 root 权限运行，可能会出现权限不足的问题。")]),t._v(" "),s("li",[t._v("解决方法：使用 "),s("code",[t._v("sudo")]),t._v(" 或切换到 root 用户。")])])]),t._v(" "),s("li",[s("strong",[t._v("错误的网卡选择")]),t._v("：\n"),s("ul",[s("li",[t._v("问题：抓包时选择了不活跃或错误的网卡（如 "),s("code",[t._v("lo")]),t._v(" 而非 "),s("code",[t._v("eth0")]),t._v("）。")]),t._v(" "),s("li",[t._v("解决方法：使用 "),s("code",[t._v("tcpdump -D")]),t._v(" 检查网卡列表，选择正确的网卡接口。")])])]),t._v(" "),s("li",[s("strong",[t._v("捕获过滤规则设置不当")]),t._v("：\n"),s("ul",[s("li",[t._v("问题：使用了过于严格的过滤规则，导致没有匹配到目标数据包。")]),t._v(" "),s("li",[t._v("解决方法：先使用较宽泛的过滤规则进行初步抓包（如 "),s("code",[t._v("tcp or udp")]),t._v("），再逐步收紧过滤条件。")])])]),t._v(" "),s("li",[s("strong",[t._v("数据包截断导致内容不完整")]),t._v("：\n"),s("ul",[s("li",[t._v("问题："),s("code",[t._v("tcpdump")]),t._v(" 默认只捕获前 96 字节，导致数据包内容不完整。")]),t._v(" "),s("li",[t._v("解决方法：使用 "),s("code",[t._v("-s 0")]),t._v(" 选项来捕获完整的数据包内容。")])])])]),t._v(" "),s("p",[t._v("通过上述方法和样例，可以更高效地使用 "),s("code",[t._v("tcpdump")]),t._v(" 进行数据包捕获和分析。")])])}),[],!1,null,null,null);s.default=_.exports}}]);