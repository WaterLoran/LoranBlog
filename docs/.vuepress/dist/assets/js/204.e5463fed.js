(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{630:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("在公司局域网中部署DNS服务器，可以让员工通过域名方便地访问内部网站和服务。以下是建立并配置DNS服务器的详细步骤，以帮助解决常见的可能问题：")]),s._v(" "),a("h3",{attrs:{id:"_1-选择合适的dns服务器软件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-选择合适的dns服务器软件"}},[s._v("#")]),s._v(" 1. "),a("strong",[s._v("选择合适的DNS服务器软件")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("推荐软件")]),s._v("：BIND、Dnsmasq或Unbound等。BIND功能强大且广泛应用，适合有复杂需求的环境；Dnsmasq较为轻量，适合小型网络。")]),s._v(" "),a("li",[a("strong",[s._v("图形化管理")]),s._v("：如果希望使用图形化界面，可以结合Webmin等管理工具来简化配置。")])]),s._v(" "),a("h3",{attrs:{id:"_2-安装dns服务器软件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装dns服务器软件"}},[s._v("#")]),s._v(" 2. "),a("strong",[s._v("安装DNS服务器软件")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("在Linux服务器上安装DNS服务器")]),s._v("：\n"),a("ul",[a("li",[s._v("使用BIND（适合复杂环境）："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS/RHEL")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" bind-utils\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu/Debian")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bind9\n")])])])]),s._v(" "),a("li",[s._v("或者，使用Dnsmasq（适合小型环境）："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" dnsmasq\n")])])])])])]),s._v(" "),a("li",[a("strong",[s._v("安装Webmin")]),s._v("（可选）：便于通过图形化界面管理BIND。")])]),s._v(" "),a("h3",{attrs:{id:"_3-配置dns区域文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置dns区域文件"}},[s._v("#")]),s._v(" 3. "),a("strong",[s._v("配置DNS区域文件")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("定义局域网专用域名")]),s._v("：选择一个公司内部使用的域名，例如"),a("code",[s._v("company.local")]),s._v("或"),a("code",[s._v("internal.company.com")]),s._v("，以防止与公共域名冲突。")]),s._v(" "),a("li",[a("strong",[s._v("配置正向区域文件")]),s._v("：在BIND中，编辑或创建一个区域文件（例如，"),a("code",[s._v("/etc/bind/db.company.local")]),s._v("），包含内部网站的DNS记录。")]),s._v(" "),a("li",[a("strong",[s._v("示例配置")]),s._v("（BIND区域文件）："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n@   IN  SOA     ns1.company.local. admin.company.local. "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 序列号，每次更改区域文件后要递增\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("604800")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 刷新时间\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 重试时间\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2419200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 过期时间\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 最小TTL\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 定义名称服务器\n    IN  NS      ns1.company.local.\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" DNS服务器的A记录\nns1 IN  A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.10\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 内部网站的A记录\nwww IN  A       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.20\nintranet IN A   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.21\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_4-配置dns服务的全局设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置dns服务的全局设置"}},[s._v("#")]),s._v(" 4. "),a("strong",[s._v("配置DNS服务的全局设置")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("监听地址")]),s._v("：确保DNS服务器监听公司局域网的接口。对于BIND，可以在"),a("code",[s._v("/etc/bind/named.conf.options")]),s._v("（或"),a("code",[s._v("/etc/named.conf")]),s._v("）中指定监听地址："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen-on port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DNS服务器的IP地址")]),s._v("\n    allow-query "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许查询的局域网IP段")]),s._v("\n    recursion "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_5-配置dns转发器-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置dns转发器-可选"}},[s._v("#")]),s._v(" 5. "),a("strong",[s._v("配置DNS转发器（可选）")])]),s._v(" "),a("ul",[a("li",[s._v("如果需要解析外部域名，可以配置DNS转发器，将外部请求转发到公共DNS服务器，例如Google或Cloudflare。"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("forwarders "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Google DNS")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Cloudflare DNS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_6-测试dns配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-测试dns配置"}},[s._v("#")]),s._v(" 6. "),a("strong",[s._v("测试DNS配置")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("语法检查")]),s._v("：使用以下命令检查BIND配置文件是否正确。"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" named-checkconf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" named-checkzone company.local /etc/bind/db.company.local\n")])])])]),s._v(" "),a("li",[a("strong",[s._v("重启DNS服务")]),s._v("："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart bind9     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ubuntu/Debian")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart named     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS/RHEL")]),s._v("\n")])])])]),s._v(" "),a("li",[a("strong",[s._v("使用"),a("code",[s._v("dig")]),s._v("或"),a("code",[s._v("nslookup")]),s._v("测试解析")]),s._v("："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" @192.168.1.10 www.company.local\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_7-在局域网内设置dns服务器地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-在局域网内设置dns服务器地址"}},[s._v("#")]),s._v(" 7. "),a("strong",[s._v("在局域网内设置DNS服务器地址")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("在路由器/DHCP服务器中配置DNS")]),s._v("：如果路由器或DHCP服务器支持自定义DNS选项，将该DNS服务器（例如，"),a("code",[s._v("192.168.1.10")]),s._v("）配置为默认DNS，这样每个通过DHCP连接的设备会自动使用它。")]),s._v(" "),a("li",[a("strong",[s._v("手动配置客户端设备")]),s._v("：如需要，也可以在客户端设备的网络设置中，手动将DNS服务器地址更改为公司DNS服务器的IP地址。")])]),s._v(" "),a("h3",{attrs:{id:"_8-解决可能遇到的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-解决可能遇到的问题"}},[s._v("#")]),s._v(" 8. "),a("strong",[s._v("解决可能遇到的问题")])]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("防火墙配置")]),s._v("：确保防火墙允许DNS服务器的53端口（UDP和TCP）通信。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("/udp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("/tcp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("缓存和DNS刷新")]),s._v("：客户端设备可能会缓存旧的DNS记录，如果遇到解析问题，可以在客户端上刷新DNS缓存：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Windows")]),s._v("："),a("code",[s._v("ipconfig /flushdns")])]),s._v(" "),a("li",[a("strong",[s._v("macOS/Linux")]),s._v("：重新连接网络或重启网络服务。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("DNS转发问题")]),s._v("：如果外部解析请求失败，检查DNS服务器的转发器配置是否正确，确保服务器可以访问公共DNS。")])])]),s._v(" "),a("h3",{attrs:{id:"_9-设置和优化日志记录-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-设置和优化日志记录-可选"}},[s._v("#")]),s._v(" 9. "),a("strong",[s._v("设置和优化日志记录（可选）")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("通过日志监控DNS服务器的运行状态和请求情况，便于排查解析问题。")])]),s._v(" "),a("li",[a("p",[s._v("在"),a("code",[s._v("named.conf.options")]),s._v("中启用日志记录，并指定日志文件路径：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("logging "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    channel default_debug "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/named/bind.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        severity debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        print-category "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        print-severity "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        print-time "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_10-定期维护和更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-定期维护和更新"}},[s._v("#")]),s._v(" 10. "),a("strong",[s._v("定期维护和更新")])]),s._v(" "),a("ul",[a("li",[s._v("定期检查区域文件并更新DNS记录，确保所有内部服务都能正确解析。")]),s._v(" "),a("li",[s._v("如果有新服务上线或IP更改，及时更新区域文件并重启DNS服务。")])]),s._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("通过以上步骤，您可以在公司局域网中建立一个稳定的DNS服务器，便于员工通过域名访问内部服务。确保在路由器或客户端设备中正确配置DNS服务器地址，并定期维护DNS配置，以确保解析准确、快速。")])])}),[],!1,null,null,null);a.default=e.exports}}]);