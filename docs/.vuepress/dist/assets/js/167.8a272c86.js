(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{597:function(s,a,t){"use strict";t.r(a);var e=t(2),_=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("在 MySQL 8 中，排查慢查询仍然是提升数据库性能的重要任务。MySQL 8 提供了更多的功能和改进来帮助你发现并优化慢查询。下面是一些详细步骤和工具，帮助你在 MySQL 8 中排查慢 SQL 查询：")]),s._v(" "),a("h3",{attrs:{id:"_1-启用和配置慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启用和配置慢查询日志"}},[s._v("#")]),s._v(" 1. "),a("strong",[s._v("启用和配置慢查询日志")])]),s._v(" "),a("p",[s._v("慢查询日志可以帮助你记录执行时间超过阈值的 SQL 查询。你可以通过以下步骤启用和配置慢查询日志：")]),s._v(" "),a("h4",{attrs:{id:"_1-1-启用慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-启用慢查询日志"}},[s._v("#")]),s._v(" 1.1 "),a("strong",[s._v("启用慢查询日志")])]),s._v(" "),a("p",[s._v("你可以使用以下命令在 MySQL 8 中启用慢查询日志，并查看其状态：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 检查当前慢查询日志状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slow_query_log'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'long_query_time'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 启用慢查询日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" slow_query_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ON'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置慢查询日志的时间阈值（秒）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" long_query_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置为 1 秒，超过 1 秒的查询将记录")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 检查慢查询日志文件位置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" VARIABLES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slow_query_log_file'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- （可选）记录没有使用索引的查询")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" log_queries_not_using_indexes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ON'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("strong",[a("code",[s._v("slow_query_log")])]),s._v("：启用慢查询日志功能。")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("long_query_time")])]),s._v("：设置慢查询的时间阈值，超过该时间的 SQL 查询会被记录下来。")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("log_queries_not_using_indexes")])]),s._v("：启用该选项记录未使用索引的查询。")])]),s._v(" "),a("h4",{attrs:{id:"_1-2-查看慢查询日志文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-查看慢查询日志文件"}},[s._v("#")]),s._v(" 1.2 "),a("strong",[s._v("查看慢查询日志文件")])]),s._v(" "),a("p",[s._v("慢查询日志默认保存在文件中。你可以通过 "),a("code",[s._v("SHOW VARIABLES LIKE 'slow_query_log_file';")]),s._v(" 找到该日志文件的位置，然后使用系统工具（如 "),a("code",[s._v("cat")]),s._v("、"),a("code",[s._v("less")]),s._v("、"),a("code",[s._v("grep")]),s._v("）来查看或分析日志文件。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /path/to/slow_query_log\n")])])]),a("h3",{attrs:{id:"_2-使用-mysqldumpslow-分析慢查询日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-mysqldumpslow-分析慢查询日志"}},[s._v("#")]),s._v(" 2. "),a("strong",[s._v("使用 "),a("code",[s._v("mysqldumpslow")]),s._v(" 分析慢查询日志")])]),s._v(" "),a("p",[s._v("MySQL 自带的 "),a("code",[s._v("mysqldumpslow")]),s._v(" 工具可以帮助你分析慢查询日志。它会对日志进行汇总，展示最慢或最频繁的查询。")]),s._v(" "),a("h4",{attrs:{id:"使用-mysqldumpslow-工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-mysqldumpslow-工具"}},[s._v("#")]),s._v(" 使用 "),a("code",[s._v("mysqldumpslow")]),s._v(" 工具：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysqldumpslow "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" t "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" /path/to/slow_query_log\n")])])]),a("ul",[a("li",[a("strong",[a("code",[s._v("-s t")])]),s._v("：按查询时间排序（"),a("code",[s._v("t")]),s._v(" 为时间，"),a("code",[s._v("c")]),s._v(" 为次数，"),a("code",[s._v("l")]),s._v(" 为锁等待时间）。")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("-t 10")])]),s._v("：显示前 10 条最慢的查询。")])]),s._v(" "),a("p",[a("code",[s._v("mysqldumpslow")]),s._v(" 将提取出查询日志中的有用信息，如最慢的查询、出现频率最高的查询等，帮助你快速定位需要优化的 SQL 查询。")]),s._v(" "),a("h3",{attrs:{id:"_3-使用-explain-语句分析查询执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-explain-语句分析查询执行计划"}},[s._v("#")]),s._v(" 3. "),a("strong",[s._v("使用 "),a("code",[s._v("EXPLAIN")]),s._v(" 语句分析查询执行计划")])]),s._v(" "),a("p",[s._v("MySQL 8 中，使用 "),a("code",[s._v("EXPLAIN")]),s._v(" 语句可以帮助你分析慢查询的执行计划，找出查询性能瓶颈。")]),s._v(" "),a("h4",{attrs:{id:"explain-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#explain-示例"}},[s._v("#")]),s._v(" "),a("code",[s._v("EXPLAIN")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" your_table "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" some_column "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"explain-结果解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#explain-结果解读"}},[s._v("#")]),s._v(" "),a("code",[s._v("EXPLAIN")]),s._v(" 结果解读：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("type")]),s._v("：表示查询的类型。最好的类型是 "),a("code",[s._v("const")]),s._v("、"),a("code",[s._v("ref")]),s._v("，最差的是 "),a("code",[s._v("ALL")]),s._v("（全表扫描）。\n"),a("ul",[a("li",[a("strong",[s._v("ALL")]),s._v("：表示全表扫描，通常性能较差。")]),s._v(" "),a("li",[a("strong",[s._v("ref")]),s._v("：表示使用索引。")]),s._v(" "),a("li",[a("strong",[s._v("range")]),s._v("：表示使用索引范围扫描。")])])]),s._v(" "),a("li",[a("strong",[s._v("possible_keys")]),s._v("：查询可能使用的索引。")]),s._v(" "),a("li",[a("strong",[s._v("key")]),s._v("：实际使用的索引。如果为空，说明没有使用索引。")]),s._v(" "),a("li",[a("strong",[s._v("rows")]),s._v("：预计扫描的行数，行数越多，性能越差。")]),s._v(" "),a("li",[a("strong",[s._v("Extra")]),s._v("：提供额外信息，如 "),a("code",[s._v("Using filesort")]),s._v("（表示排序操作）和 "),a("code",[s._v("Using temporary")]),s._v("（表示使用临时表）。")])]),s._v(" "),a("p",[a("code",[s._v("EXPLAIN")]),s._v(" 可以帮助你了解查询是否使用了索引、查询的执行路径是否合理等。如果发现查询没有使用索引，或者有全表扫描，可以通过优化索引和查询结构来提升性能。")]),s._v(" "),a("h3",{attrs:{id:"_4-使用-explain-analyze-查看实际执行过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用-explain-analyze-查看实际执行过程"}},[s._v("#")]),s._v(" 4. "),a("strong",[s._v("使用 "),a("code",[s._v("EXPLAIN ANALYZE")]),s._v(" 查看实际执行过程")])]),s._v(" "),a("p",[s._v("MySQL 8 新增了 "),a("code",[s._v("EXPLAIN ANALYZE")]),s._v("，该功能不仅提供查询的执行计划，还会告诉你实际执行过程中消耗的时间和执行的步骤。它是分析慢查询更强大的工具。")]),s._v(" "),a("h4",{attrs:{id:"explain-analyze-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#explain-analyze-示例"}},[s._v("#")]),s._v(" "),a("code",[s._v("EXPLAIN ANALYZE")]),s._v(" 示例：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ANALYZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" your_table "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" some_column "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"结果解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结果解读"}},[s._v("#")]),s._v(" 结果解读：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("EXPLAIN ANALYZE")]),s._v(" 会显示每个步骤的执行时间、处理的行数等，帮助你更直观地了解哪些操作消耗了较多的时间。这样你可以准确地知道慢查询的瓶颈点在哪里。")])]),s._v(" "),a("h3",{attrs:{id:"_5-优化-sql-查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-优化-sql-查询"}},[s._v("#")]),s._v(" 5. "),a("strong",[s._v("优化 SQL 查询")])]),s._v(" "),a("p",[s._v("在分析查询执行计划后，你可以采取一些措施来优化 SQL 查询，常见的优化方法包括：")]),s._v(" "),a("h4",{attrs:{id:"_5-1-添加或优化索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-添加或优化索引"}},[s._v("#")]),s._v(" 5.1 "),a("strong",[s._v("添加或优化索引")])]),s._v(" "),a("p",[s._v("确保查询中的 "),a("code",[s._v("WHERE")]),s._v("、"),a("code",[s._v("JOIN")]),s._v(" 和 "),a("code",[s._v("ORDER BY")]),s._v(" 子句中使用的列有适当的索引。如果查询没有使用索引，性能会明显下降。")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("单列索引")]),s._v("：对常用的查询条件列添加单列索引。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" idx_column_name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" your_table "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("复合索引")]),s._v("：对多个条件列使用的复合索引，可以提高多条件查询的性能。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" idx_composite "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" your_table "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" column2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h4",{attrs:{id:"_5-2-优化查询结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-优化查询结构"}},[s._v("#")]),s._v(" 5.2 "),a("strong",[s._v("优化查询结构")])]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("避免 "),a("code",[s._v("SELECT *")])]),s._v("：只查询所需的列，而不是整个表中的所有列，这样可以减少不必要的数据传输。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" column1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" column2 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" your_table "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" condition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("限制结果集")]),s._v("：通过使用 "),a("code",[s._v("LIMIT")]),s._v(" 或其他方式减少查询返回的数据量。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" column1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" your_table "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" condition "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("优化 "),a("code",[s._v("JOIN")]),s._v(" 操作")]),s._v("：确保 "),a("code",[s._v("JOIN")]),s._v(" 操作中的关联列有适当的索引，避免全表扫描。")])])]),s._v(" "),a("h3",{attrs:{id:"_6-使用-performance-schema-分析慢查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-使用-performance-schema-分析慢查询"}},[s._v("#")]),s._v(" 6. "),a("strong",[s._v("使用 "),a("code",[s._v("Performance Schema")]),s._v(" 分析慢查询")])]),s._v(" "),a("p",[s._v("MySQL 8 中的 "),a("code",[s._v("Performance Schema")]),s._v(" 可以帮助你分析系统的性能，包括慢查询的相关信息。你可以使用 "),a("code",[s._v("events_statements_summary_by_digest")]),s._v(" 表来查找执行时间最长的查询。")]),s._v(" "),a("h4",{attrs:{id:"查询最耗时的语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询最耗时的语句"}},[s._v("#")]),s._v(" 查询最耗时的语句：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n    DIGEST_TEXT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    COUNT_STAR "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" exec_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    SUM_TIMER_WAIT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" total_exec_time_sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    AVG_TIMER_WAIT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000000000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" avg_exec_time_sec\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n    performance_schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events_statements_summary_by_digest\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("\n    total_exec_time_sec "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("这将列出执行时间最长的前 10 条 SQL 查询，帮助你发现系统中的慢查询。")]),s._v(" "),a("h3",{attrs:{id:"_7-锁争用分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-锁争用分析"}},[s._v("#")]),s._v(" 7. "),a("strong",[s._v("锁争用分析")])]),s._v(" "),a("p",[s._v("除了查询本身可能导致的性能问题，锁争用也是导致慢查询的一个重要原因。如果数据库中存在大量的表锁或行锁等待，查询性能也会受到影响。你可以通过以下命令检查锁争用情况：")]),s._v(" "),a("h4",{attrs:{id:"检查-innodb-锁争用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查-innodb-锁争用"}},[s._v("#")]),s._v(" 检查 InnoDB 锁争用：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"检查当前等待的查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查当前等待的查询"}},[s._v("#")]),s._v(" 检查当前等待的查询：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FULL")]),s._v(" PROCESSLIST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("在 "),a("code",[s._v("SHOW ENGINE INNODB STATUS")]),s._v(" 中，查看 "),a("code",[s._v("TRANSACTIONS")]),s._v(" 部分，找到是否有长时间的锁等待。锁争用通常与事务的处理时间或并发量有关，解决方法包括：")]),s._v(" "),a("ul",[a("li",[s._v("优化事务，使其更短、更快地完成。")]),s._v(" "),a("li",[s._v("使用合适的隔离级别，减少锁的持有时间。")]),s._v(" "),a("li",[s._v("检查并发执行的查询，避免频繁锁定相同的资源。")])]),s._v(" "),a("h3",{attrs:{id:"_8-其他优化方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-其他优化方法"}},[s._v("#")]),s._v(" 8. "),a("strong",[s._v("其他优化方法")])]),s._v(" "),a("h4",{attrs:{id:"_8-1-调整-innodb-缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-调整-innodb-缓存"}},[s._v("#")]),s._v(" 8.1 "),a("strong",[s._v("调整 InnoDB 缓存")])]),s._v(" "),a("p",[s._v("适当调整数据库的缓存设置可以提升整体性能，尤其是对慢查询有一定的帮助。比如：")]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("innodb_buffer_pool_size")])]),s._v("：这是 InnoDB 的缓存池，增大这个参数可以使更多数据缓存到内存中，从而减少磁盘 I/O 操作。")])]),s._v(" "),a("h4",{attrs:{id:"_8-2-表碎片清理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-表碎片清理"}},[s._v("#")]),s._v(" 8.2 "),a("strong",[s._v("表碎片清理")])]),s._v(" "),a("p",[s._v("如果表进行了大量的 "),a("code",[s._v("UPDATE")]),s._v(" 和 "),a("code",[s._v("DELETE")]),s._v(" 操作，可能会导致表的碎片化，进而影响查询性能。你可以通过 "),a("code",[s._v("OPTIMIZE TABLE")]),s._v(" 来减少表的碎片。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" your_table_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_9-持续监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-持续监控"}},[s._v("#")]),s._v(" 9. "),a("strong",[s._v("持续监控")])]),s._v(" "),a("p",[s._v("最后，使用监控工具对系统进行持续监控是发现慢查询的有效手段。你可以结合 MySQL 8 的 "),a("code",[s._v("Performance Schema")]),s._v("、"),a("strong",[s._v("Prometheus")]),s._v("、"),a("strong",[s._v("Grafana")]),s._v(" 等监控工具，实时跟踪数据库的查询性能、负载情况和锁争用情况。")]),s._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("启用慢查询日志")]),s._v("：设置合适的 "),a("code",[s._v("long_query_time")]),s._v(" 来捕获慢查询。")]),s._v(" "),a("li",[a("strong",[s._v("使用 "),a("code",[s._v("mysqldumpslow")]),s._v(" 分析日志")]),s._v("：识别最慢的查询和频繁出现的查询。")]),s._v(" "),a("li",[s._v("**")])]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("EXPLAIN")]),s._v(" 和 "),a("code",[s._v("EXPLAIN ANALYZE")]),s._v("**：详细分析查询的执行计划，找出性能瓶颈。\n4. "),a("strong",[s._v("优化查询")]),s._v("：通过添加索引、优化查询结构和减少数据传输量来提升查询性能。\n5. "),a("strong",[s._v("使用 "),a("code",[s._v("Performance Schema")])]),s._v("：分析系统的整体性能和慢查询的执行情况。\n6. "),a("strong",[s._v("处理锁争用")]),s._v("：检查锁等待和事务处理，减少锁争用对性能的影响。")]),s._v(" "),a("p",[s._v("通过以上步骤，你可以有效排查并优化 MySQL 8 中的慢查询，从而提升数据库的整体性能。")])])}),[],!1,null,null,null);a.default=_.exports}}]);