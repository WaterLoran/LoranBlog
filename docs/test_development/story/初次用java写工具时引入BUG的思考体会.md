# 初次用java写工具时引入BUG的思考体会



## 背景

以为测试没啥活干了, 然后又想着去增进一下java能力, 所以在开会的时候瞄准了开发的小需求, 该需求比较独立, 和其他的没有什么关联, 目的是哟啊和隔壁部门打通数据对接, 即某个流程图转成bpmn

## 引入BUG的思考

1. java编码能力不足
   在这之前, 我一共编写不到300行java代码, 只是看过相关文档, 以及对照着书本, 抄了300行左右的代码, 并且阅读各类文档, 大概知道JAVA的运行原理, 也知道java工程师如何运行起来的. 不过python的编码量不少, 各类平常的数据处理工具, 图形页面类工具都能编写. 

   在这次编写工具的过程中, 首当其冲的是, 我分不清java的int, Integer, Double, double之前的区别 以及他们之前的转换, 以及java的强类型风格所带来的编码约束, 所以一开始时候, 是有点不习惯的, 但确实感觉严谨规范.

   以及有python的编码习惯, 我还以为java中的 / 运算符的逻辑和python是一样的, 但是实际上不完全一样, java中的有int 和Integer, python 则没有. 因为这个问题, 我还算错了一个点的坐标. 即相差了0.5

   后来写的多了之后, 就发现, 我用 HashMap 常常需要各类的类型转换, 发现就会引入很多不必要的代码, 我也知道代码质量不好, 就在想当初应该早点用类来存这些变量才是, 但是, 我一开始写的时候, 我以为处理的数据很简单, 然后HashMap可以很好的存取了, 并且也不会有什么变化了, 所以, 就直接用HashMap了.  但是到后来需求增加之后, 就越来越发现代码重复度很高. 所以, 这个类型问题, 是这个过程中, 耗费我大量调试时间的点, 后来, 我也确实对部分数据用类来存取了.

2. 数据结构设计不好
   java天生提供了很好的代码抽象能力, 但是, 我不懂, 就直接沿用了python的编码风格, 用HashMap来存放数据, 就类似于python 用字典来存放数据, 在python那边处理较为平面的数据(不是立体的或者多维的), 并且业务逻辑是线性的, 所以处理起来确实轻松. 

3. 需求增加但原始的代码概要设计并没有满足
   一开始的时候, 我以为只是简单的转换, 不需要考虑对元素进行大小的转换, 所以, 我没有去设计较为复杂的或者通用的逻辑, 所以, 我就直接简单粗暴的将逻辑写出来了. 后来对接后, 对方说, 哪些元素的大小需要修改, 然后才发现我的代码逻辑不支持, 所以, 只能重构部分代码, 但是重构部分还是有限, 不够彻底, 不够全局通用, 其实就是还是有冗余的代码. 所以, 我想, 要写出好的代码, 最开始的时候, 应该尽可能的去分析, 他未来可能会有哪些变化, 然后按照更高维度的去抽象和规划代码

4. 迭代时拷贝旧代码但并没做充分单元测试
   这个是发生在我调试的时候, 那个代码很长时间没找出问题来. 问题出在于, 我只对模块的外围进行测试, 没去想里面会如何, 其实里面的代码, 我对部分逻辑是测试过的, 另外一部分逻辑, 没测, 因为那个逻辑堵着很简单, 感觉不会有问题, 并且写代码写的正爽, 就不太想去测试, 在爽感和过度自信的情况下, 就没有限去做充分的单元测试了, 所以后来, 在多模块集成的时候, 就发现总有异常. 后来, 才一步步回溯到那个模块内部的逻辑, 才解决的.

5. 各类异常场景考虑不足
   写代码时候, 写正常场景的逻辑处理, 确实舒服, 但是实际上, 异常场景的处理, 所花费的时间, 估计, 也要占总编码时间的1/3 到 1/2. 然后, 在自己时间没有充足的情况下, 或者是, 没有外界去监督反馈的情况下, 有可能就不想去处理各类异常场景了. 所以, 写完正常场景, 确实要返回来充分思考异常场景的逻辑, 并且做对应预防.