# 简易测试平台Demo

最近学习了挺多知识,然后做个简易的测试平台Demo,将知识技能巩固一下

## 功能

1. 支持上传有excel用例文件
2. 支持解析excel文件,获取用例比用存入数据库
3. 支持就量数据库的用例读出,并提供给前台展示
4. 支持前端选择用例并下发到后台去执行
5. 支持执行完成用例之后,收集报告信息,并将链接整理到前台
6. 支持将测试结果发送给负责人
7. 支持测试任务进度查看和自动刷新

## 实现方法

1. 前端用vue2 和 Vuetify实现,
2. 后端使用Python, Flask, Celery来实现,其中Flask主要做web框架,celery做一步任务处理,主要处理测试用例异步执行的任务
3. 用例的读取和解析,使用openpyxl来读取,使用Python来解析

## 解决的最头疼的问题

即测试任务进度的刷新

如果要刷新任务进度,那么就需要在提交测试任务之后,定时去轮询测试任务进度

1. 提交celery异步任务之后,会返回一个任务进度的实例
2. 使用celery的定时任务去轮询任务进度,但是在定时任务中并不能直接读取该异步任务的信息,该方案否决掉
3. 使用g全局变量来保存任务进度实例的信息,然后再使用celery的定时任务去获取,但是g变量只是临时的,该方法否决掉
4. 使用序列化的方式,将任务进度的实例信息序列化到数据库在,然后再其他地方反序列化出来,然后再去刷新,但是这里有个问题,如果该请求结束,那么任务进度的实例即越会释放,那么在其他线程中反序列化出来的实例将不可访问的,所以该方案否定
5. 最后使用全局变量来保存测试任务进度实例,然后再多线程中去刷新的方法,因为Flask入口处查看PID和请求中查看PID是一样的,即数据可以共享,那么多线程,就可以解决问题
6. 但是还会遇到一个问题,那就是轮询的线程如果没有延时的话,那么将会分配到很多时间,导致原本主业务的线程,没有足够的时间工作,也会导致业务失败,所以,还需要在线程中去做一定延时

相关代码地址: https://github.com/WaterLoran/TestStudio





