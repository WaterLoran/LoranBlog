# 弱网测试关键监控指标清单

## 一、网络层基础指标

### 1. 连接指标
| 指标           | 监控点                   | 正常范围 | 弱网阈值            |
| -------------- | ------------------------ | -------- | ------------------- |
| **网络延迟**   | TCP连接时间、DNS解析时间 | <200ms   | >1000ms（重度弱网） |
| **抖动**       | 延迟波动范围             | <50ms    | >300ms              |
| **丢包率**     | 数据包丢失比例           | <0.1%    | >5%（需要告警）     |
| **带宽利用率** | 实际使用/理论带宽        | 60-80%   | >95%（拥堵）        |

### 2. 传输指标
- **TCP重传率**：>3%表示网络不稳定
- **连接超时率**：HTTP请求超时比例
- **握手失败率**：TLS/SSL握手失败次数
- **MTU匹配度**：是否因MTU不匹配导致分片

## 二、应用层性能指标

### 1. 响应时间指标
```markdown
关键时间节点监控：
1. 首字节时间（TTFB）
   - 正常：<500ms
   - 弱网可接受：<3000ms

2. DOM加载时间
   - 正常：<2000ms
   - 弱网可接受：<8000ms

3. 首屏可见时间
   - 正常：<3000ms
   - 弱网可接受：<10000ms

4. 完全加载时间
   - 正常：<5000ms
   - 弱网可接受：<15000ms
```

### 2. 请求成功率指标
| 请求类型     | 成功率要求（正常网） | 成功率要求（弱网） |
| ------------ | -------------------- | ------------------ |
| 关键API请求  | >99.9%               | >95%               |
| 静态资源请求 | >99.5%               | >90%               |
| 上传/下载    | >99%                 | >85%               |
| 长连接消息   | >99.8%               | >80%               |

### 3. 流量效率指标
```yaml
压缩效率:
- GZIP压缩率：应达到60-80%
- 图片压缩：WebP比JPEG节省25-35%
- 缓存命中率：静态资源>85%

无效流量:
- 重复请求比例：<5%
- 404请求占比：<1%
- 取消请求占比：<10%
```

## 三、业务功能指标

### 1. 关键路径成功率
```markdown
核心业务漏斗转化率：
1. 登录流程
   - 弱网环境下成功率：>90%
   - 平均耗时：<15秒

2. 支付流程
   - 弱网支付成功率：>95%
   - 超时后状态一致性：100%

3. 列表加载
   - 首次加载成功率：>95%
   - 分页加载失败率：<5%

4. 文件传输
   - 大文件断点续传成功率：>98%
   - 传输中断恢复时间：<30秒
```

### 2. 错误类型分布
```excel
需分类统计的错误类型：
1. 超时类错误 (40XX)
2. 服务端错误 (50X)
3. 网络断开错误
4. 解析错误
5. 业务逻辑错误
```

## 四、用户体验指标

### 1. 交互响应指标
```markdown
可感知的延迟阈值：
- 按钮点击反馈：<100ms（即时）
- 页面切换：<500ms（流畅）
- 列表滚动：<16ms（60FPS）
- 动画流畅度：不掉帧

弱网体验降级标准：
- 加载等待提示：2秒内必须出现
- 超时提示：10-30秒后显示
- 重试机制：至少提供2次自动重试
```

### 2. 用户行为指标
| 行为指标         | 正常环境基线 | 弱网容忍度  |
| ---------------- | ------------ | ----------- |
| **页面跳出率**   | <30%         | 允许增加50% |
| **平均停留时间** | >2分钟       | 可减少30%   |
| **操作放弃率**   | <5%          | <15%        |
| **重试操作次数** | <2次         | <5次        |

## 五、资源消耗指标

### 1. 客户端资源
```yaml
CPU占用:
- 正常网络：<30%
- 弱网处理：<50%（额外20%用于重试/缓冲）

内存占用:
- 缓存增长：弱网下可增加20-30%
- 连接池占用：监控连接泄漏

电量消耗:
- 弱网相比正常：增加不超过50%
- 持续弱网发热：温度升高<5℃
```

### 2. 服务端资源
- **QPS变化**：弱网下请求量可能增加（重试）
- **连接数**：长连接保持时间延长
- **错误日志量**：监控异常增长

## 六、恢复能力指标

### 1. 网络切换指标
```markdown
网络环境切换测试：
1. 弱网→正常网恢复时间
   - 自动重连时间：<3秒
   - 数据同步延迟：<5秒

2. 断网→有网恢复
   - 感知恢复时间：<2秒
   - 待处理操作恢复：100%

3. 跨网络类型切换（WiFi→4G）
   - 无缝切换成功率：>95%
   - 切换期间数据丢失：0
```

### 2. 容错机制指标
| 容错场景   | 预期行为 | 度量标准           |
| ---------- | -------- | ------------------ |
| 请求超时   | 自动重试 | 最多3次，间隔递增  |
| 连接断开   | 自动重连 | 10秒内尝试3次      |
| 数据不一致 | 冲突解决 | 用户无感知自动合并 |
| 服务不可用 | 降级方案 | 核心功能仍可用     |

## 七、稳定性指标

### 1. 崩溃与异常
```markdown
稳定性红线：
- 崩溃率（Crash Rate）：<0.1%
- ANR率（应用无响应）：<0.5%
- 内存泄漏：0新增
- 线程死锁：0

弱网特有异常：
- SocketTimeoutException占比
- ConnectionResetException频率
- 缓冲区溢出次数
```

### 2. 性能衰减曲线
```python
# 监控性能随网络质量下降的斜率
def calculate_degradation_slope():
    """
    正常网性能为基准100%
    弱网性能衰减应在合理范围内：
    - 2G环境：性能降至30-50%
    - 弱4G：性能降至60-80%
    - 网络波动：性能波动<±20%
    """
    return degradation_rate
```

## 八、业务KPI影响指标

### 1. 转化相关
| 业务KPI    | 正常网基准 | 弱网允许降幅     |
| ---------- | ---------- | ---------------- |
| 注册转化率 | -          | <20%下降         |
| 购买转化率 | -          | <15%下降         |
| 日活跃用户 | -          | <5%下降          |
| 用户留存率 | -          | 次日留存降幅<10% |

### 2. 质量相关
- **用户投诉率**：弱网相关投诉<总投诉的10%
- **应用商店评分**：弱网差评占比<5%
- **客服咨询量**：网络问题咨询<总咨询的15%

## 九、监控告警阈值设置

### 1. 实时告警阈值
```yaml
P0级别（立即处理）:
- 关键API成功率<90%持续5分钟
- 平均响应时间>10秒持续3分钟
- 连接失败率>20%持续2分钟

P1级别（1小时内处理）:
- 静态资源加载失败率>15%
- 页面白屏率>5%
- 用户操作无响应>3%

P2级别（24小时内处理）:
- 流量异常增长>50%
- 缓存命中率<60%
- 图片加载失败率>10%
```

### 2. 趋势监控
```markdown
需要建立基线对比的指标：
1. 同比昨日相同时段
2. 环比上周同一天
3. 不同网络环境对比
4. 不同地域用户对比
```

## 十、测试报告指标模板

### 测试结果汇总表
```markdown
| 指标类别 | 测试项 | 正常网 | 2G模拟 | 弱4G | 达标情况 |
|----------|--------|--------|--------|------|----------|
| 网络层 | 平均延迟 | 50ms | 450ms | 180ms | ✓/✗ |
|          | 丢包率 | 0.1% | 4.8% | 1.5% | ✓/✗ |
| 应用层 | API成功率 | 99.9% | 94.2% | 98.1% | ✓/✗ |
|          | 首屏时间 | 2.1s | 8.5s | 4.3s | ✓/✗ |
| 业务层 | 登录成功率 | 99.8% | 90.3% | 97.5% | ✓/✗ |
|          | 支付成功率 | 99.7% | 88.9% | 96.8% | ✓/✗ |
| 用户体验 | 操作响应 | 98ms | 520ms | 210ms | ✓/✗ |
|          | 加载超时率 | 0.5% | 12.3% | 4.2% | ✓/✗ |
```

## 关键建议

1. **优先级排序**：根据业务重要性对指标分级
2. **建立基线**：每次发布前记录正常网性能基线
3. **自动化监控**：将关键指标集成到CI/CD流水线
4. **用户视角**：优先关注用户可感知的指标
5. **持续优化**：根据监控数据持续调整阈值和策略

通过这些指标的系统化监控，可以全面评估应用在弱网环境下的表现，为优化提供数据支持，最终提升用户在不良网络条件下的使用体验。