# Devops过程中的各种迭代交付问题

## 背景

已经做某个产品1年多的时间了, 但是还是陆陆续续有各种小问题, 以及各种救火场景, 对比起以前的工作, 升级的紧张程度甚至是现在的十倍, 但是每次的升级都是十拿九稳的. 所以我就想为啥一个如此简单的问题, 还会引入这么多小问题, 却还是仍然不能妥善完美解决. 所以, 就想写这篇文章来总结一下. 

目前的用的是devops的迭代模式, 并且是多个大客户定制, 小量通用需求在基线版本迭代的研发模式, 测试的主要流程是, 开发开发完自测后, 让测试在内部的测试环境测试, 经过一轮测试之后, 再将镜像部署到客户的测试环境(UAT环境), 最后在UAT环境测试完成之后, 就最后推送到客户的生产环境去升级并正式使用.

### 出现过的问题

1. 迭代的时候一些配置没有更新到客户的UAT环境
2. 迭代时候还有一定量的微弱影响的功能BUG的时候, 也推送到客户的UAT环境去测试
3. 经常性引入一些改动引发的BUG
4. 一些性能问题很难得到及时发现, 更别说能够让开发有人力投入去优化
5. 有些问题已经在客户的生产环境使用上一段时间了, 已产生生产数据无法回退, 导致只能在已有的数据库上去写sql去维护或修改过程的垃圾数据. 相当于增加了新的改动引发的可能性.
6. 由于之前过程手动修改过数据库导致在升级的时候常需要辅助人工去解决各种数据库表结构的变更问题
7. 在给不同类型数据库的客户去做升级的时候, 常常需要更多的人工维护数据库表结构

## 为什么会引进这些问题

整体来看, 是研发的生产力赶不上客户上线的迫切需求, 失去一定的主动性, 转而被动的去响应, 并且各种问题日积月累导致技术债越来越大. 

1. 由于快速的devops迭代模式, 如果不是严谨的测试, 可能不会有全面完善的测试用例和过程评审
2. 因为开发和测试公用同一套测试环境, 虽然可能数据的构造和复用哟很大方便, 但是容易有各种使用上的冲突和约束, 以及碰到一些疑似BUG的现象可能大概率会被忽略
3. 新版本推送到客户的UAT环境之后, 也就是第二轮测试, 大概率不会得到充分的验证, 而是采用一种类似于探索式测试的回归测试. 并且客户环境下的各种垃圾数据和异常数据是很难被预测的.
4. 开发由于被合同deadline逼迫, 又想着有测试兜底和测试环境兜底, 所以可能并不会充分自测. 
5. 开发直接通过修改数据库来解决实际问题, 有时候会引入一些新的问题. 
6. 在客户UAT环境发现的BUG会导致更多的修复时间, 而这些BUG的回归测试并不会很充分(比如需要分析到根因和修改方法和影响范围), 因为这个时候的回归可能是售后或者技术服务, 也就不是更专业的测试
7. 可能最重要的一点, 整个devops的交付过程中, 由开发主导, 测试通常跟随于开发的行动, 可能就不会有充足的时间来测试, 相当于, 测试只能出一部分力气, 不能有全面完善的覆盖. 

## 可能的改进措施

1. 规划好测试交付工作的工作量, 并且和客户争取多一些时间, 留一些缓冲时间, 尽可能在时间资源和人力资源上保有余地.
2. 充分信任测试, 让测试负责交付的过程, 并且跟测试要求质量结果, 而不是由开发来跟进整个过程
3. 尽量在前端控制好需求和工作量的输入, 如果实在是需求多可以考虑加班或者外包出去, 避免工作来那个堆积而导致慌忙而顾此失彼.
4. 增加一些文档工作, 即开发和测试定期或者在过程中输出各类文档, 用于复盘, 奖励和追溯. 
5. 引入一些辅助性工具, 比如JCCI来快速回归.
6. 引入产品经理的试用环节, 因为在devops过程中, 产品经理反而是对需求更加敏感和了解的全面, 不像瀑布迭代模式的软件, 通常会期望想测试一样深度理解这个系统的内部.